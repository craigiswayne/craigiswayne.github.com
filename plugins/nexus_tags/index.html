<form class=tag_cloud method=post action="/?class=bb_one_tags&method=add_users_tags" onsubmit="add_tag(this); var cloud = this; ajaxForm(this,this.querySelector('.new'),null,null,function(){merge_tags(cloud);}); return false;">
	<input type=hidden name="global[fields][module]" value="(#module#)">
	<input type=hidden name="global[fields][_id]" value="(#_id#)">
	<style>
	
		@-webkit-keyframes slide_in_from_right{
			from{
				right:-50px;
				opacity:0.1;
			}
			to{
				right:0px;
				opacity:1;
			}
		}
		
		@keyframes slide_in_from_left{
			from{
				right:-50px;
				opacity:0.1;
			}
			to{
				right:0px;
				opacity:1;
			}
		}
	
		.tag_cloud{
			width:100%;
			max-width:300px;
			display:block;
			margin:auto;
		}
		
		.tag_cloud .existing,
		.tag_cloud .new:not(:empty){
			margin:10px;
			text-align:center;
		}
		
		.tag_cloud .existing:empty:before {
			content: "There are currently no tags for this item...";
		}
		
		.tag_cloud input[type=submit]{
			display:none;
		}
		
		.tag_cloud input[type=hidden][name*=tags] ~ input[type=submit]{
			display:block;
			margin:auto;
		}
		
		.tag_cloud input[type=button],
		.tag_cloud input[type=reset]{
			width: calc(50% - 2px);
		}
	
		
		.tag_cloud input[type=text]{
			display:block;
			width:100%;
			margin:0px 0px 10px 0px;
		}
		
		
		.tag:before {
			content: "";
			float: left;
			position: absolute;
			top: 0;
			left: -12px;
			width: 0;
			height: 0;
			border-color: rgba(0, 0, 0, 0) rgb(0, 137, 224) rgba(0, 0, 0, 0) rgba(0, 0, 0, 0);
			border-style: solid;
			border-width: 12px 12px 14px 0;
		}
		
		.tag{
			opacity:0;
			margin:2px 8px;
			padding: 0 10px 0 12px;
			background: rgb(0, 137, 224);
			color: rgb(255, 255, 255);
			text-decoration: none;
			-moz-border-radius-bottomright: 4px;
			-webkit-border-bottom-right-radius: 4px;
			border-bottom-right-radius: 4px;
			-moz-border-radius-topright: 4px;
			-webkit-border-top-right-radius: 4px;
			border-top-right-radius: 4px;
			height: 26px;
			display: inline-block;
			position:relative;
			line-height:24px;
			box-shadow: 2px 1px 10px -2px rgba(0, 0, 0, 0.8);
			-webkit-animation:slide_in_from_right 0.8s 0.3s ease forwards;
			animation:slide_in_from_right 0.8s 0.3s ease forwards;
			position:relative;
		}
		
		.tag:after{
			content: "";
			position: absolute;
			top: 10px;
			left: 0;
			float: left;
			width: 4px;
			height: 4px;
			-moz-border-radius: 2px;
			-webkit-border-radius: 2px;
			border-radius: 2px;
			background: rgb(255, 255, 255);
			-moz-box-shadow: -1px -1px 2px #004977;
			-webkit-box-shadow: -1px -1px 2px rgb(0, 73, 119);
			box-shadow: -1px -1px 2px rgb(0, 73, 119);
		}
		
		
	</style>
	
	<script>
	
		function merge_tags(cloud){
			cloud = cloud || document.querySelector(".tag_cloud");
			
			if(!cloud){console.warn("No Cloud Found"); return false;}
			
			var form_data_fields = cloud.querySelectorAll("input[type=hidden][name*=tags]");
			
			
			for(var i=0; i<form_data_fields.length; i++){
				var new_tag = cloud.querySelector(".existing").appendChild(document.createElement("label"));
				new_tag.className = "tag";
				new_tag.innerHTML = form_data_fields[i].value;
				form_data_fields[i].parentNode.removeChild(form_data_fields[i]);
			}

		}
	
		function add_tag(cloud){
			
			cloud = cloud || document.querySelector(".tag_cloud");
			
			if(!cloud){console.warn("No Cloud Found"); return false;}
			
			var new_tag_area = cloud.querySelector(".new");
			
			var tag_input = cloud.querySelector("input[type=text]");
			tag_input.value.trim();
			if(tag_input.value==""){console.warn("Tag Name cannot be empty"); return;}
			
			var new_tags=tag_input.value.split(" ");
			tag_input.value = "";
			for(var i=0; i<new_tags.length; i++){
			
				if(new_tags[i]!=""){
					var tag_data_field = cloud.insertBefore(document.createElement("input"),cloud.firstElementChild);
					tag_data_field.type = "hidden";
					tag_data_field.name = "global[fields][tags][]";
					tag_data_field.value = new_tags[i];
					
					var tag = new_tag_area.appendChild(document.createElement("label"));
					tag.innerHTML = new_tags[i];
					tag.className = "tag";
				}
			}
			
			tag_input.focus();
		}
		
		function clear_user_tags(cloud){
			cloud = cloud || document.querySelector(".tag_cloud");
			
			if(!cloud){console.warn("No Cloud Found"); return false;}
			
			cloud.querySelector(".new").innerHTML="";
			cloud.querySelector("input[type=text]").value="";
			
			var form_data_fields = cloud.querySelectorAll("input[type=hidden][name*=tags]");
			
			for(var i=0; i<form_data_fields.length; i++){
				form_data_fields[i].parentNode.removeChild(form_data_fields[i]);
			}
		}
	</script>
	<div class="existing">(#existing_tags#)</div>
	<div class="new"></div>
	<input type=text>
	<input type=button value="Add Tag" onclick="add_tag(this.parentNode);">
	<input type=reset value="Cancel" onclick="clear_user_tags(this.parentNode);">
	<input type=submit value="Save Tags">
</form>
