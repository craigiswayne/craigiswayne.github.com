server
{
  listen 80;
  # server_name ~^(?<subdomain>.*)local.netnuus.com;
  server_name local.netnuus.com *.netnuus.com default_server;
  # rewrite ^(.*) https://$subdomain.$domain.$tld$1 permanent;
  return 301 https://$server_name$request_uri;
}

# server
# {
#   listen 80;
#   server_name www.fabien.com;
#   rewrite ^(.*) https://fabien.local.netnuus.com permanent;
# }

server
{
  listen 443;
  ssl on;
  #ssl_certificate /usr/local/etc/nginx/ssl/nginx.crt;
  #ssl_certificate_key /usr/local/etc/nginx/ssl/nginx.key;
  ssl_certificate /usr/local/var/www/netnuus.com.crt;
  ssl_certificate_key /usr/local/var/www/netnuus.com.key;
  keepalive_timeout 70;
  server_name local.netnuus.com *.netnuus.com default_server;

  root html/netnuus.com;

  index index.html index.php README.md Home.md;
  autoindex on;
  # include global/wordpress-multisite.conf;

  ###
  # Caching logic
  # - https://www.nginx.com/resources/admin-guide/content-caching/
  ###
  # proxy_cache one;
  # proxy_cache_min_uses 5;
  # proxy_cache_methods GET HEAD POST;
  # proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;

  # location = /favicon.ico
  # {
  #   log_not_found off;
  # }
  #
  # location = /robots.txt
  # {
  #   allow all;
  #   log_not_found off;
  # }

  # location /
  # {
  #   try_files $uri $uri/ /index.php?$args;
  # }

  location / {
      #index index.php;
      try_files $uri $uri/ /index.php?$args;
  }

  # Add trailing slash to */wp-admin requests.
  #rewrite /wp-admin$ $scheme://$host$uri/ permanent;

  # # Directives to send expires headers and turn off 404 error logging.
  # location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
  #     expires 24h;
  #     log_not_found off;
  # }

  # this prevents hidden files (beginning with a period) from being served
      # location ~ /\.          { access_log off; log_not_found off; deny all; }

  # Pass uploaded files to wp-includes/ms-files.php.
  rewrite /files/$ /index.php last;

  if ($uri !~ wp-content/plugins) {
      rewrite /files/(.+)$ /wp-includes/ms-files.php?file=$1 last;
  }

  # Rewrite multisite '.../wp-.*' and '.../*.php'.
  if (!-e $request_filename) {
      rewrite ^/[_0-9a-zA-Z-]+(/wp-.*) $1 last;
      rewrite ^/[_0-9a-zA-Z-]+.*(/wp-admin/.*\.php)$ $1 last;
      rewrite ^/[_0-9a-zA-Z-]+(/.*\.php)$ $1 last;
  }

  # location ~ \.php$ {
  #     client_max_body_size 25M;
  #     try_files      $uri =404;
  #     #fastcgi_pass   unix:/var/run/php5-fpm.sock;
  #     fastcgi_pass php;
  #     fastcgi_index  index.php;
  #     #include        /etc/nginx/fastcgi_params;
  #     include        fastcgi_params;
  # }


  location ~ \.php$
  {
    if ($uri = /markdown.php)
    {
      root html;
    }

    include fastcgi.conf;
    fastcgi_intercept_errors on;
    fastcgi_pass php;
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_index index.php;
    fastcgi_param PHP_VALUE "auto_prepend_file=/usr/local/var/www/craigiswayne.github.com/dotfiles/wp/wp-config-develop.php";
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    # fastcgi_param SERVER_NAME $subdomainlocal.netnuus.com;

    # add_header X-NGINX-Server 'wordpress-generic-regex';
    # add_header X-NGINX-Cache-Status $upstream_cache_status;
  }

  location ~* \.(jpe?g|gif|css|png|js|ico|pdf|zip|tar|t?gz|mp3|wav|swf|woff|bmp|svg)$
  {
    access_log off;
    # try_files $uri $uri/ @try_www_environment @try_live_environment @try_live_cdn @try_staging_environment @try_dev_environment;
    try_files $uri $uri/;
    # try_files $uri $uri/ @try_live_cdn @try_www_environment @try_live_environment;
    # try_files $uri $uri/ @try_www_environment @try_staging_environment @try_dev_environment;
    expires off;
  }

}
